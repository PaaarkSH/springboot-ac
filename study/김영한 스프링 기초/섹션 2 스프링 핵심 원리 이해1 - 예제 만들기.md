# 섹션 2 스프링 핵심 원리 이해1 - 예제 만들기

# 프로젝트 생성

<aside>
💡 목표: 순수한 자바로 스프링 개발 → 실제 요구사항에서 대처가 가능한가?

</aside>

## 팁

- 인텔리제이에서 gradle 빌드 설정을 intelij 로 변경
    - gradle 통해서 스프링 부트 실행하는것 보다 intelij 가 직접 jvm 을 실행시키는게 빠르다 하심
        - 돌아가는 구조는 gradle 이 jvm 을 실행하는 과정과 크게 다를것은 없음

# 비즈니스 요구사항과 설계

## 회원

- 회원을 가입하고 조회할 수 있음
- 회원은 일반과 VIP 두가지 등급이 있음
- 회원 데이터는 자체 DB 를 구축 할 수 있고, 외부 시스템과 연동할 수 있음(미확정)

## 주문과 할인 정책

- 회원은 상품을 주문 할 수 있음
- 회원 등급에 따라 할인 정책을 적용 할 수 있음
- 할인 정책은 모든 VIP 는 1000원을 할인해주는 고정 금액 할인은 적용해 달라
    - 나중에 변경 될 수 있음
- 할인 정책은 변경 가능성이 높다
    - 회사 기본 할인 정책을 아직 정하지 못했고, 오픈 직전까지 고민을 미루고 싶다
    - 최악의 경우 할인을 적용하지 않을 수 도 있다(미확정)

## 정리

- 요구사항을 보면 회원 데이터, 할인 정책 같은 부분은 지금 결정하기 어려운 부분
- 그렇다고 이런 정책이 결정될 때 까지 개발을 무기한 기다릴 수 없음
- 인터페이스를 만들고 구현체를 언제든지 갈아끼울 수 있도록 설계해야함

> “참고” 프로젝트 환경설정을 편리하게 하려고 스프링 부트를 사용한 것
지금은 스프링 없는 순수한 자바로만 개발을 진행한다는 점을 기억하자
> 

# 회사 도메인 설계

## 회원 도메인 요구사항

- 회원을 가입하고 조회할 수 있다
- 회원은 일반과 VIP 두 가지 등급이 있다
- 회원 데이터는 자체 db 를 구축 할 수 있고, 외부 시스템과 연동 할 수 있다

## 회원 도메인 협력 관계

- 클라이언트 → 회원 서비스(회원가입, 회원조회) → 회원 저장소 (메모리, db, 외부시스템 연동)
- **개발자 뿐만 아닌 기획자도 볼수있는 구조**
- 회원 저장소
    - 회원 데이터에 접근하는 계층을 새로 만듬
    - 역활 구현(구현체를 선택하면 됨)
        - 메모리 회원 저장소
            - 메모리이기 때문에 운영용으로는 못씀
        - db 회원 저장소
        - 외부 시스템 연동 회원 저장소

## 회원 클래스 다이어그램

- `MemberService` ← `MemberServiceImpl` → `MemberRepository`
- `MemberService`: interface
- `MemberServiceImpl`
    - 구현체
- `MemberRepository`: interface, 회원 저장소
    - `MemoryMemberRepository`
    - `DbMemberRepository`
- 실제 서버를 구동하지 않고 클래스들만 분석해서 볼 수 있는 그림
    - 그런데 구현체들이 동적으로 결정되는것들, 즉 서버가 뜰 때 new 결정을 하는 것들 때문에 클래스 다이어그램 만으로 보고 판단하기 어려움
    - 그래서 객체 다이어그램이라는게 있어야 함

## 회원 객체 다이어그램

<aside>
💡 메모리간의 참조들이 어떻게 되는지

</aside>

- 클라이언트 → 회원 서비스 → 메모리 회원 저장소
- 회원 서비스: `MemberServiceImpl`

# 회원 도메인 개발

<aside>
💡 본격적인 개발

</aside>

# 회원 도메인 실행과 테스트

<aside>
💡 지난 시간에 만든 코드들이 정상 동작하는지 테스트

</aside>

- 클래스 다이어그램의 코드들은 전부 구현
- 회원 객체 다이어그램이 실제 동작하는지 확인

## TroubleShooting

- 강사님은 일반적인 코드에서 테스트 코드 라이브러리를 사용하는 코드를 보여주셨는데 일반적인 설정으로 해당 코드를 돌려보면 오류가 발생했음
- 이유를 찾아보니 testImplementation 은 test 에서만 라이브러리를 가져오는 코드였어서 오류가 날 수 밖에 없었음
- dependency 를 해당 코드처럼 수정해줘야만 돌아감

```java
dependencies {
    implementation 'org.springframework.boot:spring-boot-starter-web'
    implementation 'org.springframework.boot:spring-boot-starter-jdbc'
    implementation 'org.junit.jupiter:junit-jupiter:5.8.1'
    implementation 'org.springframework.boot:spring-boot-starter-test'
    testImplementation 'org.springframework.boot:spring-boot-starter-test'
}
```

## 회원 도메인 설계의 문제점

- 이 코드의 설계상 문제점은 무엇일까요?
- 다른 저장소로 변경할 때 OCP 원칙을 준수할 까요?
- DIP 를 잘 지키고 있을까요?
- **의존관계가 인터페이스 뿐만 아니라 구현까지 모두 의존하는 문제점이 있음**
    - **주문까지 만들고나서 문제점과 해결 방안을 설명**
- 구현체는 인터페이스를 의존하고있음
    - 하지만 실제 할당하는 부분은 구현체에 의존됨
    - 추상화에도 의존하고 구현체에도 의존됨

```java
 private final MemberRepository memberRepository = new MemoryMemberRepository();
 // 만약 MemoryMemberRepository 말고 다른 구현체를 써야 한다면??
```

# 주문과 할인 도메인 설계

# 주문과 할인 도메인 개발

# 주문과 할인 도메인 실행과 테스트